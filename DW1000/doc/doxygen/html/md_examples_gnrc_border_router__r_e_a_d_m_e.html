<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>gnrc_border_router using automatic configuration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="riot-logo.png"/></td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief">DecaRange RTLS ARM Application</div>
    </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">gnrc_border_router using automatic configuration </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This setup uses a single serial interface, ethos (Ethernet Over Serial) and UHCP (micro Host Configuration Protocol). Ethos multiplexes serial data to separate ethernet packets from shell commands. UHCP is in charge of configuring the wireless interface prefix and routes on the BR.</p>
<p>The script <code>start_network.sh</code> enables a <em>ready-to-use</em> BR in only one command.</p>
<h2>Requirements</h2>
<p>This functionality works only on Linux machines. Mac OSX support will be added in the future (lack of native <code>tap</code> interface).</p>
<h2>Setup</h2>
<p>First, you need to compile <code>ethos</code>. Go to <code>/dist/tools/ethos</code> and type:</p>
<div class="fragment"><div class="line">make clean all</div></div><!-- fragment --><p>Then, you need to compile UHCP. This tool is found in <code>/dist/tools/uhcp</code>. So, as for <code>ethos</code>:</p>
<div class="fragment"><div class="line">make clean all</div></div><!-- fragment --><p>Afterwards, proceed to compile and flash <code>gnrc_border_router</code> to your board:</p>
<div class="fragment"><div class="line">make clean all flash</div></div><!-- fragment --><h2>Usage</h2>
<p>Start the <code>start_network.sh</code> script by doing on <code>dist/tools/ethos</code>:</p>
<div class="fragment"><div class="line">sudo sh start_network.sh /dev/ttyACMx tap0 2001:db8::/64</div></div><!-- fragment --><p>This will execute the needed commands to setup a <code>tap</code> interface and configure the BR. Notice that this will also configure <code>2001:db8::/64</code> as a prefix. This prefix should be announced to other motes through the wireless interface.</p>
<p>As said previously, <code>ethos</code> allows to send IP packets and shell commands. This is done through the same serial interface. By typing <code>help</code> you will get the list of available shell commands.</p>
<p>At this point you should be able to ping motes using their global address. For instance, if you use the <a href="https://github.com/RIOT-OS/RIOT/tree/master/examples/gnrc_networking"><code>gnrc_networking</code></a> example on the mote, you can ping it from your machine with:</p>
<div class="fragment"><div class="line">&gt; ping6 2001:db8:0:1234:0:567:8:1</div></div><!-- fragment --><p>Just replace this address by your mote's address. Using <code>ifconfig</code> on the shell of your mote shows you the addresses of your mote, for instance:</p>
<div class="fragment"><div class="line">Iface  7   HWaddr: 59:72  Channel: 26  Page: 0  NID: 0x23</div><div class="line">            Long HWaddr: 5a:46:10:6e:f2:f5:d9:72 </div><div class="line">            TX-Power: 0dBm  State: IDLE  max. Retrans.: 3  CSMA Retries: 4 </div><div class="line">            AUTOACK  CSMA  MTU:1280  HL:64  6LO  RTR  RTR_ADV  IPHC  </div><div class="line">            Source address length: 8</div><div class="line">            Link type: wireless</div><div class="line">            inet6 addr: ff02::1/128  scope: local [multicast]</div><div class="line">            inet6 addr: fe80::5846:106e:f2f5:d972/64  scope: local</div><div class="line">            inet6 addr: ff02::1:fff5:d972/128  scope: local [multicast]</div><div class="line">            inet6 addr: 2001:db8::5846:106e:f2f5:d972/64  scope: global</div><div class="line">            inet6 addr: ff02::2/128  scope: local [multicast]</div></div><!-- fragment --><p>The script also sets up a ULA (Unique Local Address) address on your Linux <code>tap0</code> network interface. You can check your ULA on your PC with <code>ifconfig</code> Linux command. On this example, such address can be pinged from 6lo motes:</p>
<div class="fragment"><div class="line">&gt; ping6 fd00:dead:beef::1</div></div><!-- fragment --><p>Thus far, IPv6 communication with between your PC and your motes is enabled.</p>
<h2>Issues</h2>
<p>A known issue <a href="https://github.com/RIOT-OS/RIOT/issues/5122">#5122</a> is that after ~15min global addresses on the BR Neighbour Cache dissappear. We are investigating why it happens and we'll propose a solution soon. If you experience it, just reboot your nodes and they will come again on-line.</p>
<h1>gnrc_border_router with manual config</h1>
<p>You can use <code>ethos</code> as a standalone driver, if you want to setup the BR manually.</p>
<h2>Setup</h2>
<p>To select ethos as the serial driver, be sure that the <code>Makefile</code> has the following:</p>
<div class="fragment"><div class="line">ifeq (,$(filter native,$(BOARD)))</div><div class="line">GNRC_NETIF_NUMOF := 2</div><div class="line">USEMODULE += ethos gnrc_netdev2</div><div class="line">CFLAGS += &#39;-DETHOS_UART=UART_DEV(0)&#39; -DETHOS_BAUDRATE=115200 -DUSE_ETHOS_FOR_STDIO</div><div class="line">FEATURES_REQUIRED += periph_uart</div><div class="line">endif</div><div class="line"># include UHCP client</div><div class="line">USEMODULE += gnrc_uhcpc</div></div><!-- fragment --><p>You'll need IPv6 access to the nodes attached to the BR from your Linux PC. To do this, it is necessary to add a <code>tap</code> interface. As an example, you can do it as follows:</p>
<div class="fragment"><div class="line">sudo ip tuntap add tap0 mode tap user ${USER}</div></div><!-- fragment --><p>This will setup your <code>tap</code> interface. Then configure it to route the packets coming from your 6lo network:</p>
<div class="fragment"><div class="line">sudo ip link set tap0 up</div><div class="line">sudo ip a a 2001:db8::1/48 dev tap0</div><div class="line">sudo ip r d 2001:db8::/48 dev tap0</div><div class="line">sudo ip r a 2001:db8::2 dev tap0</div><div class="line">sudo ip r a 2001:db8::/48 via 2001:db8::2 dev tap0</div></div><!-- fragment --><p>Please note that the prefix <code>2001:db8::</code> is used as an example.</p>
<p>Then you can flash the <code>gnrc_border_router</code> example on your board:</p>
<div class="fragment"><div class="line">make clean all flash</div></div><!-- fragment --><p>On this RIOT BR two interfaces are present. A wired interface represents the serial link between Linux and your mote. A wireless interface represents the 802.15.4 radio link. In order to route packets between this two interfaces, you can do the following:</p>
<div class="fragment"><div class="line">&gt; ifconfig 6 add 2001:db8::2/48</div><div class="line">&gt; ifconfig 5 add 2001:db8::3/64</div><div class="line">&gt; fibroute add :: via &lt;link-local of tap&gt; dev 6</div></div><!-- fragment --><p>By adding the address to the wireless interface the prefix will be disseminated. This prefix will be automatically added by the motes in the radio range.</p>
<h2>Usage</h2>
<p>Run ethos by choosing a serial interface according to your board. For instance <code>/dev/ttyUSB*</code> or <code>/dev/ttyACM*</code>.</p>
<div class="fragment"><div class="line">sudo ./ethos tap0 /dev/ttyACM0</div></div><!-- fragment --><p>Now, you should be able to ping your nodes. Use the global address starting by your prefix, on our case <code>2001:db8::</code>:</p>
<div class="fragment"><div class="line">&gt; ping6 2001:db8:0:1234:0:567:8:1</div></div><!-- fragment --><h1>gnrc_networking_border_router with SLIP</h1>
<h2>Requirements</h2>
<p>In order to setup a 6LoWPAN border router on RIOT, you need either a board that offers an IPv6 capable network interface (e.g. the <code>encx24j600</code> Ethernet chip) or connect it over the serial interface to a Linux host and use the SLIP standard [1]. The example application in this folder assumes as a default to be run on an Atmel SAM R21 Xplained Pro evaluation board using an external UART adapter for the second serial interface. However, it is feasible to run the example on any RIOT supported platform that offers either more than one UART or be equipped with an IPv6 capable network device. In this case only the Makefile of this application has to be slightly modified, e.g. by replacing the line </p><div class="fragment"><div class="line">USEMODULE += gnrc_slip</div></div><!-- fragment --><p> with something like </p><div class="fragment"><div class="line">USEMODULE += encx24j600</div></div><!-- fragment --><p> and specify the target platform as <code>BOARD = myplatform</code>. In order to use the border router over SLIP, please check the <code>periph_conf.h</code> of the corresponding board and look out for the <code>UART_NUMOF</code> parameter. Its value has to be bigger than 1.</p>
<p>Be sure that you have replaced on your <code>Makefile</code> the lines to use SLIP. You should have something like this:</p>
<div class="fragment"><div class="line">ifeq (,$(SLIP_UART))</div><div class="line"># set default (last available UART)</div><div class="line">SLIP_UART=&quot;UART_DEV(UART_NUMOF-1)&quot;</div><div class="line">endif       </div><div class="line">ifeq (,$(SLIP_BAUDRATE))        </div><div class="line"># set default       </div><div class="line">SLIP_BAUDRATE=115200</div><div class="line">endif</div><div class="line"></div><div class="line">GNRC_NETIF_NUMOF := 2</div><div class="line">INCLUDES += -I$(CURDIR)</div><div class="line">CFLAGS += -DSLIP_UART=$(SLIP_UART)</div><div class="line">CFLAGS += -DSLIP_BAUDRATE=$(SLIP_BAUDRATE)</div><div class="line"># Include SLIP package for IP over Serial communication</div><div class="line">USEMODULE += gnrc_slip</div></div><!-- fragment --><h2>Configuration</h2>
<p>In order to connect a RIOT 6LoWPAN border router over SLIP you run a small program called tunslip (imported from Contiki) [2] on the Linux host. The program can be found in the <code>dist/tools/tunslip</code> folder and has to be compiled before first use (simple calling <code>make</code> should be enough). Now, one can start the program by calling something like: </p><div class="fragment"><div class="line">cd dist/tools/tunslip</div><div class="line">make</div><div class="line">sudo ./tunslip6 2001:db8::1/64 -t tun0 -s /dev/ttyUSB0</div></div><!-- fragment --><p> Assuming that <code>/dev/ttyUSB0</code> is the device descriptor for the (additional) UART interface of your RIOT board.</p>
<p>On the RIOT side you have to configure the SLIP interface by configuring a corresponding IPv6 address, e.g. </p><div class="fragment"><div class="line">ifconfig 6 add 2001:db8::2</div></div><!-- fragment --><p> and adding the SLIP interface to the neighbor cache (because Linux won't respond to neighbor solicitations on an interface without a link-layer address) by calling </p><div class="fragment"><div class="line">ncache add 6 2001:db8::1</div></div><!-- fragment --><p>Then, to propagate the prefix you should add an address to the wireless interface:</p>
<div class="fragment"><div class="line">ifconfig 5 add 2001:db8::3</div></div><!-- fragment --><p>After this you're basically done and should be able to ping between the border router and the outside world (assuming that the Linux host is properly forwarding your traffic).</p>
<p>Additionally, you can configure IPv6 addresses on the 6LoWPAN interface for communication with other 6LoWPAN nodes. See also the <code>gnrc_networking</code> example for further help.</p>
<p>[1] <a href="https://tools.ietf.org/html/rfc1055">https://tools.ietf.org/html/rfc1055</a></p>
<p>[2] <a href="https://github.com/contiki-os/contiki/blob/master/tools/tunslip.c">https://github.com/contiki-os/contiki/blob/master/tools/tunslip.c</a> </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon May 15 2017 18:50:48 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
